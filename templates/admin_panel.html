{% extends "base.html" %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='adminpanel.css') }}">
{% endblock %}

{% block content %}
<div class="admin-wrapper">

    <!-- SIDEBAR -->
    <aside class="admin-sidebar">
        <div class="logo">Lost & Found Admin</div>
        <ul>
            <li class="{% if not show_recent and not show_staff %}active{% endif %}"><a
                    href="{{ url_for('admin_panel') }}">üè† Dashboard</a></li>
            <li class="{% if show_recent %}active{% endif %}"><a
                    href="{{ url_for('admin_panel') }}?show_recent=true&show_staff=false">üì¶ Items</a></li>
            <li class="{% if show_staff %}active{% endif %}"><a
                    href="{{ url_for('admin_panel') }}?show_staff=true&show_recent=false">üë• Staff</a></li>
            <li><a href="{{ url_for('logout') }}">üö™ Logout</a></li>


        </ul>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="admin-container">
        {% if not show_recent and not show_staff %}
        <div class="admin-stats">
            <div class="stat-card">
                <h3>Items Overview</h3>
                <div class="stat-value">{{ stats.total_items }}</div>
                <p>Total Items</p>
                <p>Claimed: <strong>{{ stats.claimed_items }}</strong></p>
                <p>Unclaimed: <strong>{{ stats.unclaimed_items }}</strong></p>
            </div>

            <div class="stat-card">
                <h3>Users & Staff</h3>
                <div class="stat-value">{{ stats.total_staff }}</div>
                <p>Total Staff Members</p>
                <p>Registered Users: <strong>{{ stats.total_users }}</strong></p>
            </div>

            <div class="stat-card">
                <h3>Items by Category</h3>
                {% for category, count in stats.items_by_category.items() %}
                <p><strong>{{ category }}</strong>: {{ count }}</p>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Recent Items -->

        {% if show_recent %}
        <section class="admin-section">
            <h2>Recent Items</h2>

            <div class="admin-filters">
                <form method="GET" action="{{ url_for('admin_panel') }}">
                    <input type="hidden" name="show_recent" value="true">
                    <input type="hidden" name="show_staff" value="false">

                    <!-- bag o ine -->
                    <input type="text" name="q" placeholder="üîç Search items..." value="{{ query }}"> <!-- bag o ine -->

                    <!-- bag o ine -->
                    <select class="admin-select" name="category" onchange="this.form.submit()"> <!-- bag o ine -->

                        <option value="">All Categories</option>
                        {% for category, _ in stats.items_by_category.items() %}
                        <option value="{{ category }}" {% if selected_category==category %}selected{% endif %}>
                            {{ category }}
                        </option>
                        {% endfor %}
                    </select>
                </form>
            </div>


            <table class="admin-table">
                <tr>
                    <th>Image</th>
                    <th>Name</th>
                    <th>Category</th>
                    <th>Status</th>
                    <th>Date Found</th>
                    <th class="text-right">Actions</th>
                </tr>
                {% for item in items[-5:] %}
                <tr>
                    <td>
                        {% if item.image %}
                        <img src="{{ url_for('static', filename='uploads/' ~ item.image) }}" alt="Item Image" width="80"
                            height="80" />
                        {% else %} No Image {% endif %}
                    </td>
                    <td>{{ item.name }}</td>
                    <td>{{ item.category }}</td>
                    <td>
                        <span
                            class="status-badge {% if item.status == 'Claimed' %}status-active{% else %}status-inactive{% endif %}">
                            {{ item.status }}
                        </span>
                    </td>
                    <td>{{ item.date_found | format_datetime }}</td>
                    <td class="text-right">
                        <a href="{{ url_for('update_item', item_id=item.id) }}"
                            class="admin-btn admin-btn-secondary">Edit</a>
                        <a href="{{ url_for('delete_item', item_id=item.id) }}"
                            class="admin-btn admin-btn-danger">Delete</a>
                    </td>
                </tr>
                {% endfor %}
            </table>
        </section>
        {% endif %}


        {% if show_staff %}
        <!-- Staff Management -->
        <section class="admin-section" id="items">
            <h2>Staff Management</h2>
            <div class="admin-filters" style="display: flex; align-items: center; gap: 10px;">
                <!-- new  -->
                <form method="GET" action="{{ url_for('admin_panel') }}" class="admin-search-form"
                    style="display: flex; align-items: center; gap: 8px;">
                    <input type="hidden" name="show_staff" value="true">
                    <input type="text" name="q" class="admin-search" placeholder="Search staff..." value="{{ query }}">
                    <button type="submit" class="admin-btn admin-btn-secondary">Search</button>
                </form>

                <!-- Add Staff Button orig -->
                <a href="{{ url_for('add_staff') }}" class="admin-btn admin-btn-primary">
                    <i class="fas fa-plus"></i> Add New Staff
                </a>

            </div>
            <table class="admin-table">
                <tr>
                    <th>Image</th>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Role</th>
                    <th>Date Added</th>
                    <th class="text-right">Actions</th>
                </tr>
                {% for s in staff %}
                <tr>
                    <td>
                        {% if s.image %}
                        <img src="{{ url_for('static', filename='uploads/' ~ s.image) }}" alt="Staff Photo" width="80">
                        {% else %}
                        <img src="{{ url_for('static', filename='uploads/default.png') }}" alt="No Photo" width="80">
                        {% endif %}
                    </td>
                    <td>{{ s.id }}</td>
                    <td>{{ s.name }}</td>
                    <td><span class="status-badge status-active">{{ s.role }}</span></td>
                    <td>{{ s.date_added | format_datetime }}</td>
                    <td class="text-right">
                        <a href="{{ url_for('update_staff', staff_id=s.id) }}"
                            class="admin-btn admin-btn-secondary">Edit</a>

                        <a href="{{ url_for('delete_staff', staff_id=s.id) }}" class="admin-btn admin-btn-danger"
                            onclick="return confirm('Are you sure you want to remove this staff member?');">Remove</a> <!-- newln for delete staff -->
                    </td>
                </tr>
                {% endfor %}
            </table>
        </section>
        {% endif %}
    </main>
</div>
{% endblock %}